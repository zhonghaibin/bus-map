<!DOCTYPE html><html><head lang="en">    <meta charset="UTF-8">    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>    <script src="js/jquery1.42.min.js" type="text/javascript"></script>    <script src="js/jquery.SuperSlide.2.1.1.js" type="text/javascript"></script>    <script src="js/jquery.leanmodal.min.js" type="text/javascript"></script>    <title>公交线路对比</title>    <meta name="Keywords" content=""/>    <meta name="Description" content=""/>    <link rel="stylesheet" href="css/main1119.css"/>    <link rel="stylesheet" href="css/bus_route.css"/>    <script type="text/javascript"            src="http://webapi.amap.com/maps?v=1.3&key=b16e9282ef90c9c932f32cc705a13b92&plugin=AMap.LineSearch,AMap.Autocomplete,AMap.Transfer,AMap.Geocoder"></script>    <script type="text/javascript" src="js/addToolbar.js"></script>    <link rel="stylesheet" href="css/foot.css"/></head><body><div class="menuScroll" style="height: 1600px;margin: 0 auto;">    <div class="indexCont mainNavMenu">        <!--首页标签-->        <div class="tenScrollCont">                      <!--主体部分-->            <div id="banner" >                <div class="route clear">                    <div class="route_tit">公交线路对比</div>                    <table border="0" cellspacing="0" cellpadding="0" style="border-collapse:collapse;" id="lineTable">                        <tr class="route_detail">                            <td>路线名称</td>                            <td>媒体公司</td>                            <td>刊例价</td>                            <td>首车时间</td>                            <td>末车时间</td>                            <td>总行程</td>                            <td>站点数</td>                            <td style="width: 90px;">线路图</td>                            <td>热点统计</td>                        </tr>                                            </table>                </div>                <div  id="container" style="margin-top: 20px;border: 1px solid #dcdcdc;width:1200px;height:440px;margin:0 auto;text-align:center;position:relative;"></div>            </div>        </div>    </div>    <!--****************导航菜单***************--></div><!--弹框--><div id="HotPotWindow" class="Popup" style="width: 800px; display: none; position: fixed; opacity: 1; z-index: 998; left: 50%; margin-left: -400px; top: 100px;">    <div>        <div class="PopupHeader">            <p style="font-weight: bold">输入热点</p>            <p>                想了解公交站点周边的情况吗？            </p>            <a href="javascript:void(0)" class="modal_close"></a>        </div>        <div style="padding-left: 20px; padding-right: 20px;  line-height: 28px">            输入公交线路途经站点周边的热点，如医院、超市、学校、写字楼等。            <br />            <input type="hidden" id="hidIndex"/>            <input type="text" class="Text" id="txtAddress" style="width: 680px"  />&nbsp;<input type="button" class="btn1" value="统计" onclick="SearchHotPot()" />            <br />            <input type="radio" name="group1" id="s1" checked="checked" /><label for="s1">所有停靠站点100米内</label><br />            <input type="radio" name="group1" id="s2" /><label for="s2">300米内</label><br />            <input type="radio" name="group1" id="s3" /><label for="s3">500米内</label>        </div>        <div class="Panel" id="divHotNames"></div>    </div></div><script></script><script type="text/javascript">    var _lineStr=GetQueryString('lineStr');    var _cityName=GetQueryString('cityName');    function GetQueryString(name)    {        var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");        var r = window.location.search.substr(1).match(reg);        if(r!=null)return  decodeURI( unescape(r[2])); return null;    }    var cityName = _cityName;　	var map = new AMap.Map("container", {        resizeEnable: true,        zoom: 13 //地图显示的缩放级别	});	map.setCity(cityName);	//获取公交线路名称数组	var lineStr = _lineStr;	//根据公交名称数组，显示公交列表	var lineArr = lineStr.split(",");	for(var i=0;i<lineArr.length;i++){		//根据城市名称，公交线路名称，查询公交数据		lineSearch(cityName,lineArr[i],i);		//动态显示公交车数据		//$("#lineTable").append("<tr class='route_detail'><td>"+lineArr[i]+"</td><td><a href='#' style='color: #333;'>自己找把</a></td><td><a href='#' style='color: #333;'>自己找把</a></td><td>06：00</td><td>23：00</td><td>32.7公里</td><td>18</td><td><a href='#'><img src='images/Bus2.png' style='vertical-align: middle'/></a></td><td><a href='#'><img src='images/Pin2.png' style='vertical-align: middle'/></a></td></tr>");			} /*公交线路查询*/    function lineSearch(cityName,lineName,index) {        //实例化公交线路查询类，只取回一条路线        var linesearch = new AMap.LineSearch({            pageIndex: 1,            city: cityName,            pageSize: 1,            extensions: 'all'        });        linesearch.search(lineName, function(status, result) {            if (status === 'complete' && result.info === 'OK') {                lineSearch_Callback(result,index,lineName);            } else {                alert(result);            }        });    }    /*公交路线查询服务返回数据解析概况*/    function lineSearch_Callback(data,index,lineName) {        var lineArr = data.lineInfo;        var lineNum = data.lineInfo.length;        if (lineNum == 0) {        	        } else {            for (var i = 0; i < lineNum; i++) {            	            	var stime = lineArr[i].stime;            	if(""!=stime){            		stime = stime.substr(0,2)+":"+stime.substr(2,3);            	}else{            		stime="--";            	}            	var etime = lineArr[i].etime;            	if(""!=etime){            		etime = etime.substr(0,2)+":"+etime.substr(2,3);            	}else{            		etime="--";            	}            	            	            	$("#lineTable").append("<tr class='route_detail' id='title"+index+"'><td>"+lineName+"</td><td><a href='#' style='color: #333;'>自己找吧</a></td><td><a href='#' style='color: #333;'>自己找吧</a></td><td>"+stime+"</td><td>"+etime+"</td><td>"+lineArr[i].distance+"公里</td><td>"+lineArr[i].via_stops.length+"</td><td><a href='#'><img onclick='showLine("+index+")' src='images/Bus2.png' style='vertical-align: middle'/></a></td><td><a href='#'><input type='hidden' value='"+lineName+"' id='hidline"+index+"'/><img onclick='ShowHotPot("+index+")' src='images/Pin2.png' style='vertical-align: middle'/></a><a style='color:blue' title='' id='showCount"+index+"' onClick='showListInfo("+index+")'></a><input type='hidden' id='poiArr"+index+"'/></td></tr>");            	var aflag = "";            	var lineArrvia_stops = lineArr[i].via_stops;            	for(var j=0;j<lineArrvia_stops.length;j++){            		var stopName = lineArrvia_stops[j].name;            		aflag = aflag+"<a href='#' style='color: #333;'>"+stopName+"</a>&nbsp;";            		if(j!=lineArrvia_stops.length-1){            			aflag = aflag+">>&nbsp;";            		}            	}            	            	$("#lineTable").append("<tr  class='route_detail'><td colspan='9'>"+aflag+"</td></tr>")                        }        }    }	/*绘制路线*/    function drawbusLine(startPot, endPot, BusArr) {        //绘制起点，终点        new AMap.Marker({            map: map,            position: [startPot.lng, startPot.lat], //基点位置            icon: "http://webapi.amap.com/theme/v1.3/markers/n/start.png",            zIndex: 10        });        new AMap.Marker({            map: map,            position: [endPot.lng, endPot.lat], //基点位置            icon: "http://webapi.amap.com/theme/v1.3/markers/n/end.png",            zIndex: 10        });        //绘制乘车的路线        busPolyline = new AMap.Polyline({            map: map,            path: BusArr,            strokeColor: "#09f",//线颜色            strokeOpacity: 0.8,//线透明度            strokeWeight: 6//线宽        });        map.setFitView();    }</script><script type="text/javascript">    //    下拉框    $(function () {        $(".select").each(function () {//        var s=$(this);//        var z=parseInt(s.css("z-index"));            var dt = $(this).children("dt");            var dd = $(this).children("dd");//        展开效果            var _show = function () {                dd.slideDown(200);                dt.addClass("cur");            };//        关闭效果            var _hide = function () {                dd.slideUp(200);                dt.removeClass("cur");            };    //关闭效果            dt.click(function () {                dd.is(":hidden") ? _show() : _hide();            });//        选择效果（如需要传值，可自定义参数，在此处返回对应的“value”值 ）            dd.find("a").click(function () {                dt.html($(this).html());                _hide();            });//        $("body").click(function(i){ !$(i.target).parents(".select").first().is(s) ? _hide():"";});        })    })            function showLine(index){    	map.clearMap();    	var lineName = $("#hidline"+index).val();    	var linesearch2 = new AMap.LineSearch({            pageIndex: 1,            city: cityName,            pageSize: 1,            extensions: 'all'        });        //搜索“536”相关公交线路        linesearch2.search(lineName, function(status, result) {            if (status === 'complete' && result.info === 'OK') {                lineSearch_Callback2(result);            } else {                alert("线路绘制失败");            }        });    }              /*公交路线查询服务返回数据解析概况*/    function lineSearch_Callback2(data) {        var lineArr = data.lineInfo;        var lineNum = data.lineInfo.length;        if (lineNum == 0) {        } else {            for (var i = 0; i < lineNum; i++) {                var pathArr = lineArr[i].path;                var stops = lineArr[i].via_stops;                var startPot = stops[0].location;                var endPot = stops[stops.length - 1].location;                if (i == 0) drawbusLine(startPot, endPot, pathArr);            }        }    }            function showAround(index,poiName,distance){    	var lineName = $("#hidline"+index).val();    	//查询公交站点信息    	var linesearchAround = new AMap.LineSearch({            pageIndex: 1,            city: cityName,            pageSize: 1,            extensions: 'all'        });        linesearchAround.search(lineName, function(status, result) {            if (status === 'complete' && result.info === 'OK') {                var stationsArr = lineSearch_Callback3(result);                queryAround(stationsArr,poiName,distance,index);                            } else {                alert("线路站点信息查询失败");            }        });    	    }            /*公交路线查询服务返回数据解析概况 周边搜索功能专用*/    function lineSearch_Callback3(data) {    	var stations = new Array();         var lineArr = data.lineInfo;        var lineNum = data.lineInfo.length;        if (lineNum == 0) {        } else {            for (var i = 0; i < lineNum; i++) {                var pathArr = lineArr[i].path;                var stops = lineArr[i].via_stops;                for(var j=0;j<stops.length;j++){                	stations.push(stops[j].location);                }				            }        }        //alert(stations);        return stations;    }        function queryAround(stationsArr,poiType,distance,index){    	//初始化周边设施数量    	var aroundCnt = 0;    	var poiArr =new Array();    	var finishTimes = 0;		for(var a=0;a<stationsArr.length;a++){            AMap.service('AMap.PlaceSearch',function(){			var placeSearch= new AMap.PlaceSearch({				map:map,			});			placeSearch.setType(poiType);			placeSearch.setCity(cityName);			placeSearch.searchNearBy("", stationsArr[a], distance, function(status, result) {				finishTimes++;				if (status === 'complete' && result.info === 'OK') {					var count = result.poiList.count;										var pois = result.poiList.pois;					for(var b=0;b<pois.length;b++){						poiArr.push(pois[b].name);					}										aroundCnt = aroundCnt+count;					if (finishTimes >= stationsArr.length){						var list =  new Array();						for(var i=0;i<poiArr.length;i++){							var finded = false;							for(var j=0;j<list.length;j++){								if(poiArr[i] == list[j]){									finded = true;									break;									}							}							if (!finded){								list.push(poiArr[i]);							}						}						var spanName = $("#showCount"+index).html(poiType+"数量："+list.length);						var poiStr = list.toString();						$("#poiArr"+index).val(poiStr);						document.getElementById ("showCount"+index).title=poiStr;						}				}			});            });		}    }        function ShowHotPot(index, hotNames) {        hotPotIndex = index;        PopupModal("#HotPotWindow");        var c = document.getElementById("divHotNames");        c.style.display = "none";        $("#hidIndex").val(index);    }          function SearchHotPot() {   		map.clearMap();        CloseModal("#HotPotWindow");        var address = document.getElementById("txtAddress").value.trim();        var s1 = document.getElementById("s1");        var s2 = document.getElementById("s2");        var s3 = document.getElementById("s3");        var radius = 100;        if (s1.checked)            radius = 100;        else if (s2.checked)            radius = 300;        else if (s3.checked)            radius = 500;        if (address == "")            return;        var index = $("#hidIndex").val();        if(index==""){        	return;        }        showAround(index,address,radius);    }            function showListInfo(index){    	var poiArr = $("#poiArr"+index).val();    	alert("信息列表："+poiArr);    } </script></body></html>